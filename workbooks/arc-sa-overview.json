{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "<div style=\"display: flex; align-items: center; gap: 15px; margin-bottom: 10px;\">\r\n<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 2px; width: 24px; height: 24px;\">\r\n<div style=\"background: #F25022; border-radius: 1px;\"></div>\r\n<div style=\"background: #7FBA00; border-radius: 1px;\"></div>\r\n<div style=\"background: #00A4EF; border-radius: 1px;\"></div>\r\n<div style=\"background: #FFB900; border-radius: 1px;\"></div>\r\n</div>\r\n<h1 style=\"margin: 0;\">Arc-enabled Server & SQL Server License Dashboard</h1>\r\n</div>\r\n\r\n## Overview of Software Assurance and License compliance across your hybrid infrastructure\r\n\r\n<div style=\"background: linear-gradient(135deg, #0078D4 0%, #00A4EF 100%); color: white; padding: 15px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0,120,212,0.2);\">\r\n<h2 style=\"margin: 0; color: white;\">ğŸš€ Real-time License Monitoring</h2>\r\n<p style=\"margin: 5px 0 0 0; opacity: 0.95;\">Track compliance across your Azure Arc-enabled infrastructure</p>\r\n</div>"
      },
      "name": "title"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "subscription",
            "version": "KqlParameterItem/1.0",
            "name": "Subscriptions",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "resourceGroup",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroups",
            "label": "ğŸ—‚ï¸ Resource Groups",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type in (\"microsoft.hybridcompute/machines\", \"microsoft.azurearcdata/sqlserverinstances\")\r\n| summarize Count = count() by ResourceGroup = resourceGroup\r\n| order by ResourceGroup asc\r\n| project value = ResourceGroup, label = strcat(ResourceGroup, \" (\", Count, \" resources)\"), group = \"Resource Groups\"",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "crossComponentResources": [
              "{Subscriptions}"
            ]
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "subscriptionParams"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| where resourceGroup in ({ResourceGroups}) or '*' in ({ResourceGroups})\r\n| where properties[\"licenseProfile\"][\"softwareAssurance\"][\"softwareAssuranceCustomer\"] == true\r\n| summarize Count = count()",
        "size": 4,
        "title": "ğŸ–¥ï¸ Arc Servers - Software Assurance Enabled",
        "color": "greenDark",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Count",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false
        }
      },
      "customWidth": "25",
      "name": "tile1"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| where resourceGroup in ({ResourceGroups}) or '*' in ({ResourceGroups})\r\n| summarize \r\n    TotalServers = count(),\r\n    SoftwareAssuranceEnabled = countif(properties[\"licenseProfile\"][\"softwareAssurance\"][\"softwareAssuranceCustomer\"] == true)\r\n| project Count = TotalServers - SoftwareAssuranceEnabled",
        "size": 4,
        "title": "ğŸ–¥ï¸ Arc Servers - Software Assurance Disabled",
        "color": "redBright",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Count",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false
        }
      },
      "customWidth": "25",
      "name": "tile2"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.azurearcdata/sqlserverinstances\"\r\n| where resourceGroup in ({ResourceGroups}) or '*' in ({ResourceGroups})\r\n| where properties['licenseType'] == \"Paid\"\r\n| summarize Count = count()",
        "size": 4,
        "title": "ğŸ“ˆ Arc SQL Servers - Software Assurance Enabled",
        "color": "blueDark",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Count",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false
        }
      },
      "customWidth": "25",
      "name": "tile3"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.azurearcdata/sqlserverinstances\"\r\n| where resourceGroup in ({ResourceGroups}) or '*' in ({ResourceGroups})\r\n| where properties['licenseType'] == \"LicenseOnly\"\r\n| summarize Count = count()",
        "size": 4,
        "title": "ğŸ“ˆ Arc SQL Servers - Software Assurance Disabled",
        "color": "magenta",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Count",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false
        }
      },
      "customWidth": "25",
      "name": "tile4"
    },
    {
      "type": 1,
      "content": {
        "json": ""
      },
      "customWidth": "25",
      "name": "spacer1"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| where resourceGroup in ({ResourceGroups}) or '*' in ({ResourceGroups})\r\n| summarize \r\n    TotalServers = count(),\r\n    SoftwareAssuranceEnabled = countif(properties[\"licenseProfile\"][\"softwareAssurance\"][\"softwareAssuranceCustomer\"] == true)\r\n| extend PercentageEnabled = iff(TotalServers > 0, round((SoftwareAssuranceEnabled * 100.0) / TotalServers, 1), 0.0)\r\n| project Percentage = strcat(PercentageEnabled, \"%\")",
        "size": 4,
        "title": "ğŸ“Š Windows Server - SA Coverage %",
        "color": "orange",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Percentage",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false
        }
      },
      "customWidth": "25",
      "name": "tile5"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.azurearcdata/sqlserverinstances\"\r\n| where resourceGroup in ({ResourceGroups}) or '*' in ({ResourceGroups})\r\n| summarize \r\n    TotalServers = count(),\r\n    SoftwareAssuranceEnabled = countif(properties['licenseType'] == \"Paid\")\r\n| extend PercentageEnabled = iff(TotalServers > 0, round((SoftwareAssuranceEnabled * 100.0) / TotalServers, 1), 0.0)\r\n| project Percentage = strcat(PercentageEnabled, \"%\")",
        "size": 4,
        "title": "ğŸ“Š SQL Server - SA Coverage %",
        "color": "purple",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Percentage",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false
        }
      },
      "customWidth": "25",
      "name": "tile6"
    },
    {
      "type": 1,
      "content": {
        "json": ""
      },
      "customWidth": "25",
      "name": "spacer2"
    },
    {
      "type": 1,
      "content": {
        "json": "---\r\n\r\n<div style=\"background: linear-gradient(135deg, #00A4EF 0%, #0078D4 100%); color: white; padding: 15px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0,120,212,0.2);\">\r\n<h2 style=\"margin: 0; color: white;\">ğŸ“‹ Server Details</h2>\r\n<p style=\"margin: 5px 0 0 0; opacity: 0.95;\">Detailed view of all Arc-enabled servers and SQL instances with their licensing information</p>\r\n</div>"
      },
      "name": "separator"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "serverTypeFilter",
            "version": "KqlParameterItem/1.0",
            "name": "ServerTypeFilter",
            "label": "ğŸ–¥ï¸ Server Type Filter",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "jsonData": "[\r\n    { \"value\": \"Windows Server\", \"label\": \"Windows Servers\" },\r\n    { \"value\": \"SQL Server\", \"label\": \"SQL Servers\" }\r\n]",
            "value": [
              "Windows Server",
              "SQL Server"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "filterParameters"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type in (\"microsoft.hybridcompute/machines\", \"microsoft.azurearcdata/sqlserverinstances\")\r\n| where resourceGroup in ({ResourceGroups}) or '*' in ({ResourceGroups})\r\n| extend ServerName = name\r\n| extend ServerType = case(\r\n    type == \"microsoft.hybridcompute/machines\" and properties.osName contains \"Windows\", \"Windows Server\",\r\n    type == \"microsoft.azurearcdata/sqlserverinstances\", \"SQL Server\",\r\n    \"Other\"\r\n)\r\n| where ServerType != \"Other\"\r\n| where ServerType in ({ServerTypeFilter}) or '*' in ({ServerTypeFilter})\r\n| extend Version = case(\r\n    ServerType == \"Windows Server\", tostring(properties.osSku),\r\n    ServerType == \"SQL Server\", tostring(properties.version),\r\n    \"\"\r\n)\r\n| extend Kind = case(\r\n    ServerType == \"Windows Server\", case(\r\n        toupper(tostring(kind)) == \"HCI\", \"Azure Local (HCI)\",\r\n        toupper(tostring(kind)) == \"SCVMM\", \"SCVMM\",\r\n        toupper(tostring(kind)) == \"VMWARE\", \"VMware vSphere\",\r\n        toupper(tostring(kind)) == \"AVS\", \"Azure VMware Solution\",\r\n        toupper(tostring(kind)) == \"AWS\", \"AWS\",\r\n        toupper(tostring(kind)) == \"GCP\", \"GCP\",\r\n        isnotempty(kind), tostring(kind),\r\n        \"Physical/Other\"\r\n    ),\r\n    ServerType == \"SQL Server\", \"SQL Instance\",\r\n    \"Unknown\"\r\n)\r\n| extend SoftwareAssuranceEnabled = case(\r\n    ServerType == \"Windows Server\", iff(properties[\"licenseProfile\"][\"softwareAssurance\"][\"softwareAssuranceCustomer\"] == true, \"Yes\", \"No\"),\r\n    ServerType == \"SQL Server\", iff(properties['licenseType'] == \"Paid\", \"Yes\", \"No\"),\r\n    \"Unknown\"\r\n)\r\n| project ServerName, Kind, Version, SoftwareAssuranceEnabled, ServerType, ResourceGroup = resourceGroup, Location = location, SubscriptionId = subscriptionId\r\n| order by ServerType asc, ServerName asc",
        "size": 0,
        "title": "Server Inventory with License Information",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "SoftwareAssuranceEnabled",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Yes",
                    "representation": "success",
                    "text": ""
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "No",
                    "representation": "critical",
                    "text": ""
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "unknown",
                    "text": "?"
                  }
                ]
              }
            },
            {
              "columnMatch": "ServerType",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Windows Server",
                    "representation": "blueDark",
                    "text": "ğŸªŸ {0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "SQL Server",
                    "representation": "magenta",
                    "text": "ğŸ—ƒï¸ {0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "lightBlue",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ],
          "filter": true
        },
        "sortBy": []
      },
      "name": "serverDetails"
    },
    {
      "type": 1,
      "content": {
        "json": "> **âš ï¸ Exclusions:** This workbook only displays Windows Servers running on Arc-enabled machines. Non-Windows servers (Linux, etc.) and SQL Server instances without a configured license type are excluded from the results."
      },
      "name": "disclaimer"
    },
    {
      "type": 1,
      "content": {
        "json": "### Summary Statistics\r\n\r\nThis dashboard provides an overview of your Arc-enabled infrastructure licensing compliance:\r\n\r\n- **Software Assurance Enabled**: Servers with Software Assurance configuration enabled in Azure Portal\r\n- **Software Assurance Disabled**: Servers without Software Assurance configuration enabled in Azure Portal\r\n\r\n> **Note**: Use the built-in table filter to focus on specific server types in the detailed view."
      },
      "name": "footer"
    },
    {
      "type": 1,
      "content": {
        "json": "---\r\n\r\n<div style=\"background: linear-gradient(135deg, #0078D4 0%, #00A4EF 100%); color: white; padding: 20px; border-radius: 12px; margin: 15px 0; box-shadow: 0 4px 12px rgba(0,120,212,0.25);\">\r\n<h2 style=\"margin: 0 0 15px 0; color: white; display: flex; align-items: center; gap: 10px;\"><span style=\"font-size: 1.8em;\">ğŸ“š</span><span>How to enable Software Assurance?</span></h2>\r\n<p style=\"margin: 0 0 20px 0; opacity: 0.95; font-size: 1em;\">For servers showing as <strong>Software Assurance Disabled</strong>, use these guides to enable Software Assurance:</p>\r\n<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 20px;\"><div style=\"background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px; border-left: 4px solid #FFB900;\"><h3 style=\"margin: 0 0 10px 0; color: white;\">ğŸ—ƒï¸ SQL Server</h3><p style=\"margin: 0 0 10px 0; opacity: 0.95; font-size: 0.95em;\">Configure Software Assurance for Arc-enabled SQL Server instances</p><a href=\"https://learn.microsoft.com/en-us/sql/sql-server/azure-arc/manage-configuration?view=sql-server-ver17&tabs=azure#modify-sql-server-configuration\" style=\"color: #FFB900; font-weight: bold; text-decoration: none;\">â†’ View SQL Server Guide</a></div><div style=\"background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px; border-left: 4px solid #7FBA00;\"><h3 style=\"margin: 0 0 10px 0; color: white;\">ğŸªŸ Windows Server</h3><p style=\"margin: 0 0 10px 0; opacity: 0.95; font-size: 0.95em;\">Enable Software Assurance for Arc-enabled Windows Servers</p><a href=\"https://learn.microsoft.com/en-us/azure/azure-arc/servers/windows-server-management-overview?tabs=portal#enrollment\" style=\"color: #7FBA00; font-weight: bold; text-decoration: none;\">â†’ View Windows Server Guide</a></div></div>\r\n<div style=\"background: rgba(242,80,34,0.2); padding: 12px 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #F25022;\"><p style=\"margin: 0; opacity: 0.95;\">â±ï¸ <strong>Important:</strong> Changes may take up to 24 hours to reflect in this dashboard after enabling Software Assurance</p></div>\r\n</div>"
      },
      "name": "documentation"
    }
  ],
  "fallbackResourceIds": [
    "azure monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}